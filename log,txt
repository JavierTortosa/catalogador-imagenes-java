Iniciando Visor de Imágenes V2...
--- Iniciando VisorController (Constructor Simple) ---
--- AppInitializer: Iniciando Proceso de Inicialización Global ---
  [AppInitializer Fase A.1] Inicializando Componentes Base (Modelo, Configuración)...
    -> VisorModel creado e inyectado.
Mapa de configuración por defecto inicializado con 94 claves.
Mapa DEFAULT_GROUP_COMMENTS inicializado con 36 entradas.
Leyendo configuración desde: D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\config.cfg
Configuración leída. Total claves: 138
--- DEBUG PRE-SINCRONIZACIÓN ---
Tamaño de DEFAULT_CONFIG: 94
Tamaño de loadedConfig (del archivo): 138
DEFAULT_CONFIG contiene 'salto_bloque'?: true
loadedConfig contiene 'salto_bloque'?: true
---------------------------------
Sincronizando configuración cargada con mapa de defaults...
La configuración cargada ya contenía todas las claves por defecto. No se añadieron nuevas.
ConfigurationManager inicializado.
!!! DEBUG: Mapa 'config' INICIALIZADO. HashCode: 1604839423
    -> ConfigurationManager creado, cargado e inyectado.
  [AppInitializer Fase A.2] Aplicando Configuración a los contextos del Modelo...
[VisorModel] Inicializando estado por defecto de todos los contextos...
    -> Contextos del modelo (Visualizador, Proyecto, etc.) inicializados.
    -> Configuración de miniaturas (no contextual) aplicada al modelo.
  -> Fin de la aplicación de configuración al modelo.
  [AppInitializer Fase A.3] Inicializando Servicios Esenciales...
[ThemeManager] Tema inicial establecido a: clear
    -> ThemeManager creado e inyectado.
    -> IconUtils creado e inyectado.
[ThumbnailService] Servicio inicializado. LruCache de miniaturas creado con un tamaño máximo de 200 entradas.
    -> ThumbnailService creado e inyectado.
    -> Modelo para JList de Miniaturas creado. HashCode: 245565335
  [VisorController] Inyección de dependencia: modeloMiniaturas asignado. HashCode: 245565335
    -> ExecutorService (FixedThreadPool con 8 hilos) creado e inyectado.
  [AppInitializer Fase A.4] Creando instancia de ProjectManager...
    -> Instancia de ProjectManager (servicio) creada.
  [AppInitializer] Programando creación de UI y componentes dependientes en EDT...
--- AppInitializer: Inicialización base (fuera de EDT) completada. ---
--- VisorController: Inicialización delegada completada con éxito ---
VisorController instanciado. La inicialización de la UI ocurrirá en el EDT.
--- [AppInitializer Fase B - EDT] Reorganizando la inicialización en bloques... ---
  -> BLOQUE 1: Creando todas las instancias...
[ProjectController] Instancia creada.
  [ActionFactory] Inicializando todas las Actions...
  [ActionFactory] Todas las Actions inicializadas y mapeadas. Total: 0
[ConfigApplicationManager] Creando instancia refactorizada...
[ConfigApplicationManager] Instancia creada.
[ToolbarBuilder Constructor] Iniciando...
[ToolbarBuilder Constructor] Finalizado.
  -> BLOQUE 2: Cableando dependencias pre-UI...
[MenuBarBuilder] ControllerGlobalActionListener establecido: controlador.VisorController
  -> BLOQUE 3: Ejecutando lógica de arranque...
  [ProjectManager] Cargadas 4 rutas absolutas desde D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\.proyectos\seleccion_actual.txt
[ProjectManager] Instancia inicializada. Selección actual desde: D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\.proyectos\seleccion_actual.txt
  -> Imágenes marcadas inicialmente: 4
  [ViewBuilder] Iniciando la construcción del frame principal con estructura CardLayout...
[VisorView Constructor SIMPLIFICADO] Iniciando...
!!! DEBUG ViewBuilder: La JList o su modelo son NULOS en este punto.
  [ViewBuilder] Frame principal construido y ensamblado.
  [ActionFactory] Inicializando todas las Actions...
[ToggleMiniatureTextAction Constructor] Configurada con clave de estado: interfaz.menu.vista.mostrar_nombres_en_miniaturas.seleccionado
[ToggleSubfoldersAction Constructor] Estado inicial SELECTED_KEY: true
ActionFactory: Creando ToggleSubfoldersAction@1d64ef6b
  [SetSubfolderReadModeAction Constructor: 'Mostrar Solo Carpeta Actual'] representaModoIncluir=false, modeloActualIncluyeSubcarpetas=true, SELECTED_KEY inicializado a: false
  [SetSubfolderReadModeAction Constructor: 'Mostrar Imágenes de Subcarpetas'] representaModoIncluir=true, modeloActualIncluyeSubcarpetas=true, SELECTED_KEY inicializado a: true
[ToggleProporcionesAction Constructor] Estado inicial SELECTED_KEY: true (desde modelo)
  [ActionFactory] Todas las Actions inicializadas y mapeadas. Total: 68
  [StatusBarManager] Configurando Listeners para controles de la barra de estado...
    -> MouseListener añadido a 'label.control.zoomPorcentaje'.
    -> ActionListener añadido a 'button.control.modoZoom'.
--- MenuBarBuilder: Iniciando construcción de JMenuBar ---
  [MenuBarBuilder] ActionMap recibido con 68 acciones.
  [MenuBarBuilder] controllerGlobalActionListener: PRESENTE (VisorController)
  [MenuBarBuilder] Procesando elementos raíz de la estructura del menú...
--- MenuBarBuilder: Construcción de JMenuBar completada. ---
  [MenuBarBuilder] Total de JMenuItems mapeados por clave de configuración: 165
[ToolbarManager] FASE 1: Creando instancias de barras de herramientas...

--- [ToolbarBuilder] Construyendo barra: 'Navegación' ---

--- [ToolbarBuilder] Construyendo barra: 'Edición' ---

--- [ToolbarBuilder] Construyendo barra: 'Zoom' ---

--- [ToolbarBuilder] Construyendo barra: 'Vistas' ---

--- [ToolbarBuilder] Construyendo barra: 'Proyecto' ---

--- [ToolbarBuilder] Construyendo barra: 'Toggles' ---

--- [ToolbarBuilder] Construyendo barra: 'Utilidades' ---

--- [ToolbarBuilder] Construyendo barra: 'Apoyo' ---
  [ToolbarManager] Registrando botones individuales...
    -> 32 botones registrados.
[ToolbarManager] Creación de instancias de barras completada.
[ToolbarManager] FASE 2: Reconstruyendo contenedor de toolbars para el modo: VISUALIZADOR
  [HierarchyListener] Detectado cambio de padre en: navegacion. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: edicion. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: zoom. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: vistas. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: proyecto. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: toggle. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: utils. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: apoyo. IGNORADO (reconstrucción en progreso).
  [ToolbarManager] Contenedor de toolbars reconstruido.
  [Controller] Configurando atajos de teclado globales...
  -> Atajos de teclado globales configurados para teclado estándar y numérico.
--- [ConfigApplicationManager] Aplicando configuración globalmente... ---
[Controller Internal] Configurando Listeners (Reconstrucción)...
[Controller Internal] Listeners de Vista configurados.
[ProjectController] Listener añadido a 'list.proyecto.nombres'.
[GeneralController] Inicializado.
[GeneralController] Sincronizados botones de modo. Activo: cmd.vista.switch_to_visualizador
    [EDT Internal] Estableciendo carpeta raíz inicial desde config...
  [VisorModel] carpetaRaizActual cambiada de 'null' a 'D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\resources'
      -> Carpeta raíz establecida a: D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\resources
    [EDT Internal] Fin establecerCarpetaRaizDesdeConfigInternal. Raíz actual: D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\resources
--- [EDT] Inicialización de UI completada. Carga de datos programada. ---
  [ConfigAppManager] Aplicando configuración a la Vista (usando Registry)...
    -> Sincronizando estado visual de botones toggle...
    -> Sincronización de botones toggle completada.
    -> Aplicando estado inicial de fondo a cuadros desde config: false
    -> Configuración básica de Vista aplicada.
  [ConfigAppManager] Sincronizando UI final...
  -> [EDT Post-Visibilidad] Lanzando carga de imágenes...

-->>> INICIO cargarListaImagenes(String, Runnable) | Mantener Clave: A-gigante de hierro.jpg
  -> Limpiando caché de ThumbnailService antes de nueva carga...
[ThumbnailService] Caché de miniaturas limpiado.
[Controller] Limpiando UI y Modelo a estado vacío...
  -> Estado de imagen y selección en modelo limpiado.
  -> Vista actualizada a estado vacío (imagen principal y miniaturas).
[ThumbnailService] Caché de miniaturas limpiado.
  -> Caché de miniaturas limpiado.
    -> Sincronizando estado visual de botones toggle...
    -> Sincronización de botones toggle completada.
  [Controller] Estado visual de 'Marcar' actualizado. Marcada: false
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[Controller] Limpieza de UI y Modelo completada.
[Dialogo Progreso] Asignando worker: BuscadorArchivosWorker
  [Worker BG] Iniciando búsqueda en D:\Programacion\Eclipse\Workspace 2024-12R\VisorImagenes\resources con profundidad 2147483647
  [Worker BG] Files.walk terminado. Archivos encontrados: 201
[Worker EDT] Método done() alcanzado.
[Dialogo Progreso] Solicitud de cierre.
  -> [EDT] Cerrando diálogo...
  -> [EDT] Diálogo cerrado y desechado.
    WORKER HA TERMINADO. Número de archivos encontrados: 201
    -> Ordenando 201 claves...
    -> Creando modelo de lista en bloque...
    -> Modelo creado. Actualizando el modelo principal de la aplicación...
[Model] Actualizando contexto de lista para el modo: VISUALIZADOR
### DEBUG CONTEXT: ListContext@29f9178a: SelectedKey set to NULL (old key not found or was null).
### DEBUG CONTEXT: ListContext@29f9178a actualizado. Nuevo tamaño: 201
[VisorView] Modelo asignado a 'list.nombresArchivo'. Tamaño: 201
--> [actualizarImagenPrincipal] Iniciando carga para clave: 'A-gigante de hierro.jpg' (Índice: 0)
!!! DEBUG ListCoordinator: Voy a modificar el modelo con hashCode: 245565335
  [CalcularMiniaturas] Rango dinámico calculado -> Antes: 8, Despues: 15
[Controller] Iniciando pre-calentamiento de caché para 16 miniaturas...
[Controller] 16 tareas de pre-calentamiento de caché lanzadas al ExecutorService.
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
  -> Solicitando repintado inicial de listaMiniaturas.
    -> Sincronizando estado visual de botones toggle...
    -> Sincronización de botones toggle completada.
  [Controller] Estado visual de 'Marcar' actualizado. Marcada: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
--- [Listener Primer Renderizado]: Panel listo (1145x236). Forzando refresco de zoom y UI. ---
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
--- [Listener Primer Renderizado]: Tarea completada. Listener eliminado. ---
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
[GestionarProyectoAction] Solicitando cambio al modo PROYECTO...

--- [GeneralController] INICIANDO TRANSICIÓN DE MODO: VISUALIZADOR -> PROYECTO ---
  [ProjectController] Preparando datos para el modo proyecto...
### DEBUG CONTEXT: ListContext@72ca65a6: SelectedKey set to NULL (old key not found or was null).
### DEBUG CONTEXT: ListContext@72ca65a6 actualizado. Nuevo tamaño: 4
    -> Datos del proyecto preparados en proyectoListContext.
  [GeneralController] Saliendo del modo: VISUALIZADOR
[Model] Cambiando modo de trabajo de VISUALIZADOR a: PROYECTO
  [GeneralController] Entrando en modo: PROYECTO
  [ProjectController] Activando la UI de la vista de proyecto...
### DEBUG: Restaurando selección del proyecto. Clave guardada en contexto PROYECTO: 'null'
  [ProjectController] Actualizando imagen de proyecto para la clave: A-gigante de hierro.jpg
  [ProjectController] UI de la vista de proyecto activada.
  [GeneralController] Actualizando estado de la UI para el modo: PROYECTO
  [GeneralController] Estado de la UI actualizado.
[ViewManager] Vista cambiada a: VISTA_PROYECTOS
[ToolbarManager] FASE 2: Reconstruyendo contenedor de toolbars para el modo: PROYECTO
  [HierarchyListener] Detectado cambio de padre en: apoyo. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: utils. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: toggle. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: proyecto. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: vistas. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: zoom. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: edicion. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: navegacion. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: navegacion. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: zoom. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: proyecto. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: utils. IGNORADO (reconstrucción en progreso).
  [HierarchyListener] Detectado cambio de padre en: apoyo. IGNORADO (reconstrucción en progreso).
  [ToolbarManager] Contenedor de toolbars reconstruido.
[GeneralController] Sincronizados botones de modo. Activo: cmd.proyecto.gestionar
--- [GeneralController] TRANSICIÓN DE MODO COMPLETADA a PROYECTO ---

[VisorController] Sincronizando UI de Zoom. Modo: Porcentaje Personalizado, Permiso Manual: true
### DEBUG: InfobarImageManager.actualizarPorcentajeZoom() - INICIO
[VisorController] Sincronización de UI de Zoom completada.
--- [Controller] Iniciando apagado de la aplicación ---
  [Guardar] Guardando estado final...
!!! DEBUG: Guardando mapa. HashCode del mapa recibido: 1604839423

[ConfigurationManager guardarConfiguracion] === INICIO GUARDADO ===
[ConfigurationManager guardarConfiguracion] Intentando guardar en: config.cfg
[ConfigurationManager guardarConfiguracion] Valor de 'tema.nombre' que se intentará guardar: 'clear'
--- DEBUG: Contenido del mapa a guardar ---
  -> ¡ENCONTRADO! comportamiento.navegacion.tamano_salto_bloque = 10
------------------------------------------
Guardando configuración (preservando estructura) en config.cfg
Claves a guardar/actualizar: 138
Archivo de configuración actualizado exitosamente.
  [Guardar] Configuración guardada exitosamente.
  -> Apagando ExecutorService...
  -> ExecutorService terminado ordenadamente.
  -> Apagado limpio completado. Saliendo de la JVM con System.exit(0).
